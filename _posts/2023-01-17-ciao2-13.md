---
layout: single
title: "Streamlit Dashboard (2)êµ¬í˜„"
category: "Ciaolabella2"
tag: [streamlit, dashboard, redis]
author_profile: false
sidebar:
  nav: "docs"
---


# Dashboard êµ¬í˜„ : 
ì•ì„œ Dashboard ë¥¼ ì„¤ê³„í–ˆìœ¼ë‹ˆ, streamlit ê³¼ plotly ë¥¼ í™œìš©í•˜ì—¬ Dashboard ë¥¼ ì‹¤ì œë¡œ êµ¬í˜„í•´ ë³´ê² ë‹¤.

## 1. streamlit ì„¤ì¹˜

- ê°€ìƒí™˜ê²½ ìƒì„±
    - streamlit ë°°í¬ ì‹œ ë³„ë„ì˜ requirements.txt ë¥¼ ë„£ì–´ì£¼ì–´ì•¼ í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì´ streamlit share app ì— import ëœë‹¤.
    - ë¶ˆí•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ import ë˜ëŠ” ê²ƒ ë°©ì§€í•˜ê¸° ìœ„í•´ ë³„ë„ì˜ ê°€ìƒ í™˜ê²½ì„ ìƒì„±í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤.

```bash
conda create -n streamlit python=3.8
conda activate streamlit
```

- í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë‹¤ìš´
    - streamlit ì€ pandas DataFrame ì„ ê¸°ì¤€ìœ¼ë¡œ ì‹œê°í™”ë¥¼ í•˜ê¸° ë•Œë¬¸ì— `pandas` ë„ install í•œë‹¤.
    - streamlit ì—ì„œ ì£¼ë¡œ ì‚¬ìš©í•  `plotly` ë„ install í•œë‹¤.
    - pip install streamlit ì´ ì•ˆ ë˜ë©´ python3 -m ì„ ë¶™ì´ë©´ ëœë‹¤.

```bash
pip install streamlit
pip install pandas
pip install plotly
#python3 -m pip install streamlit
```

- streamlit í…ŒìŠ¤íŠ¸
    - ë‹¤ìŒê³¼ ê°™ì€ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ ì•„ë˜ ì‚¬ì§„ê³¼ ê°™ì´ 8501 ë²ˆ port ë¡œ ë¸Œë¼ìš°ì € ì°½ì´ ì‹¤í–‰ë˜ëŠ”ë° ê·¸ëŸ¬ë©´ ì„±ê³µí•œ ê²ƒì´ë‹¤.

```python
streamlit hello
# python3 -m streamlit hello
```

![Untitled](https://raw.githubusercontent.com/hanalog/hanalog.github.io/gh-pages/images/2023-01-17-ciao2-13/Untitled.png)

- íŒŒì¼ ì‹¤í–‰ì‹œí‚¤ê¸°
    - ë§Œì•½ `streamlit.py` ë¼ëŠ” íŒŒì¼ëª…ì— ì½”ë“œë¥¼ ì‘ì„±í–ˆë‹¤ë©´ ì•„ë˜ì™€ ê°™ì´ ì‹¤í–‰ì‹œì¼œì£¼ë©´ ì›¹ í˜ì´ì§€ê°€ ì‹¤í–‰ëœë‹¤.

```bash
streamlit run streamlit.py
```

## 2. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°

- Redis Cluster ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜

```bash
pip install redis-py-cluster
```

- í•„ìš”í•œ ëª¨ë“ˆ import

```python
from rediscluster import RedisCluster
import time
import streamlit as st
import pandas as pd
import plotly.express as px
import plotly.graph_objects as go
```

- Redis Cluster ì™€ ì—°ê²°

```python
redis_nodes = [{'host': 'cluster ip', 'port': '6300'},
							 {'host': 'cluster ip', 'port': '6301'},
							 {'host': 'cluster ip', 'port': '6302'}]
redis_password = 'redis cluster ì ‘ê·¼ ë¹„ë°€ë²ˆí˜¸'

client = RedisCluster(startup_nodes=redis_nodes, 
											password=redis_password, 
											decode_responses=True)
```

- ë¶ˆëŸ¬ì˜¬ ë°ì´í„° ê¸°ì¤€
    - Redis ì—ì„œ ë‹¹ì¼ ë¡œê·¸ ë°ì´í„°ë§Œ ì¡°íšŒí•˜ê¸° ë•Œë¬¸ì— ë‹¹ì¼ ë‚ ì§œë¥¼ date ë³€ìˆ˜ì— yyyyMMdd í˜•íƒœë¡œ ì €ì¥í•œë‹¤.
    - ex. 2022ë…„ 12ì›” 20ì¼ > 20221220

```python
date = time.strftime('%Y%m%d', time.localtime(time.time()))
```

- ê³µí†µ ì§‘ê³„ ë°ì´í„° DataFrame í˜•íƒœë¡œ ë³€í™˜
    - Redis ì— ë¬¸ìì—´ íƒ€ì…ìœ¼ë¡œ ì €ì¥ëœ ìˆ«ìë“¤ì„ ìˆ«ì type ìœ¼ë¡œ ë³€í™˜í•œë‹¤.
        - `pd.to_numeric(errors='ignore')`
            - ìˆ«ì type ìœ¼ë¡œ ë³€ê²½ ë¶ˆê°€ëŠ¥í•œ ì—´ì„ ë§Œë‚˜ë©´ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.
            - ìœ„ ì—ëŸ¬ë¥¼ ë¬´ì‹œí•˜ë„ë¡ í•˜ëŠ” ì†ì„±ì´ `errors='ignore'` ì´ë‹¤.

```python
# ------ common data
rows = list()
for key in client.scan_iter(match=f'common:{date}:*', count=100):
    temp, splitted = dict(), key.split(':')
    temp['date'], temp['hour'] = splitted[1], splitted[2]
    temp['user_gender'], temp['user_age'], temp['user_region'] = splitted[3], splitted[4], splitted[5]
    temp.update(client.hgetall(key))
    rows.append(temp)
df = pd.DataFrame(rows)
df = df.apply(pd.to_numeric, errors='ignore')
print(df.head())
```

```python
date  hour user_gender  ...  ecopoint1_click save_ecopoint1  login
0  20221220    20           W  ...                2             20      0
1  20221220    20        none  ...                0              0      3
2  20221220    17           W  ...                2            100      1
3  20221220    15           W  ...                0              0      1
4  20221220    13           M  ...                2            100      2
```

- ë¬´ë¼ë²¨ ì œí’ˆ ê²€ìƒ‰ ë°ì´í„° DataFrame í˜•íƒœë¡œ ë³€í™˜

```python
# ------ search data
rows = list()
for key in client.scan_iter(match=f'search:{date}:*', count=100):
    temp, splitted = dict(), key.split(':')
    temp['date'], temp['user_gender'], temp['user_age'] = splitted[1], splitted[2], splitted[3]
    temp['search_word'], temp['count'] = splitted[4], int(client.hget(key, 'count'))
    rows.append(temp)
df2 = pd.DataFrame(rows)
df2 = df2.apply(pd.to_numeric, errors='ignore')
print(df2)
```

```python
date user_gender  user_age search_word  count
0  20221220           M        20         ì‚¬ì´ë‹¤      2
1  20221220           W        30         ì‚¬ì´ë‹¤      1
2  20221220           M        20          í™ì°¨      1
3  20221220           W        30          ìƒìˆ˜      1
4  20221220           M        20         í—›ê°œìˆ˜      1
```

## 3. ê¸°ë³¸ ì„¤ì •

ë‹¤ìŒê³¼ ê°™ì´ í˜ì´ì§€ ì œëª©ê³¼ ì•„ì´ì½˜ì„ ì„¤ì •í•œë‹¤.

```python
# ------------ base
st.set_page_config(page_title="Ciaolabella Dashboard",
                   page_icon=":bar_chart:",
                   layout="wide")
st.write(f'# DATE : {date}')
```

## 4. ë°ì´í„° í•„í„° ìƒì„± ë° ë°ì´í„° í•„í„°ë§

íŠ¹ì • ì‹œê°„ëŒ€, ì—°ë ¹ëŒ€, ì„±ë³„, ì§€ì—­ ê´€ë ¨ ë°ì´í„°ë§Œ ì‹œê°í™”í•´ì„œ ë³´ì—¬ì¤„ ìˆ˜ ìˆë„ë¡ í•„í„° sidebarë¥¼ ì¶”ê°€í•˜ê³  df.query() ë¥¼ í†µí•´ ì„ íƒí•œ íŠ¹ì„±ì— ë§ëŠ” ë°ì´í„°ë§Œ ë¶ˆëŸ¬ì˜¨ë‹¤.

```python
# ------------ data filter
st.sidebar.header("Filter")

hour = st.sidebar.multiselect(
    "Select Hour:",
    options=df['hour'].unique(),
    default=df['hour'].unique()
)
age = st.sidebar.multiselect(
    "Select Age:",
    options=df['user_age'].unique(),
    default=df['user_age'].unique()
)
gender = st.sidebar.multiselect(
    "Select Gender:",
    options=df['user_gender'].unique(),
    default=df['user_gender'].unique()
)
region = st.sidebar.multiselect(
    "Select Region:",
    options=df['user_region'].unique(),
    default=df['user_region'].unique()
)

selected = df.query(
    "hour == @hour & user_age == @age & user_gender == @gender & user_region == @region"
)
selected2 = df2.query(
    "user_age == @age & user_gender == @gender"
)
```

## 5. ë ˆì´ì•„ì›ƒ ìƒì„±

- `with tab:` êµ¬ë¬¸ ì•ˆì—ì„œ í•´ë‹¹í•˜ëŠ” ê·¸ë˜í”„ë“¤ì„ `with item:`  êµ¬ë¬¸ ì•ˆì— ë„£ì–´ì£¼ë©´ ëœë‹¤.

```python
# ------------ make tabs
tab1, tab2, tab3, tab4 = st.tabs(["IN OUT", "MENU", "ECO POINT", "NO LABEL"])

# ------------ tab1 : login and logout
with tab1:
    item1, item2, item3 = st.columns(3)
    st.markdown("---")
    item4, item5, item6 = st.columns([1,1,1])

# ------------ tab2 : menu click
with tab2:
    item1, item2 = st.columns(2)
    st.markdown('#### ë©”ë‰´ ê°€ìˆ˜ìš” ëŒ€ë¹„ ì‹¤ìˆ˜ìš” (%)')
    item3, item4 = st.columns(2)
    item5, item6 = st.columns(2)

# ------------ tab3 : ecopoint service
with tab3:
    item1, item2 = st.columns(2)
    item3, item4 = st.columns(2)

# ------------ tab4 : nolabel service
with tab4:
    item1, item2, item3 = st.columns(3)
```

- í•„í„°ë§í•œ ë°ì´í„°ë¥¼ ì§ì ‘ í™•ì¸í•˜ê³  csv í™•ì¥ìë¡œ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ê¸°ëŠ¥ë„ ì¶”ê°€í•œë‹¤.

```python
# ------------ data download
st.markdown("---")
st.markdown('#### ğŸ”» Common ë°ì´í„° í™•ì¸ ë° ë‹¤ìš´ë¡œë“œ')
with st.expander("Click Here"):
    st.write(selected)
    st.download_button(
        label="Download .csv",
        data=selected.to_csv().encode('utf-8'),
        file_name=f'ciaolabella_common_{date}.csv',
        mime='text/csv'
    )
st.markdown('#### ğŸ”» Search ë°ì´í„° í™•ì¸ ë° ë‹¤ìš´ë¡œë“œ')
with st.expander("Click Here"):
    st.write(selected2)
    st.download_button(
        label="Download .csv",
        data=selected2.to_csv().encode('utf-8'),
        file_name=f'ciaolabella_search_{date}.csv',
        mime='text/csv'
    )
```

- ì•„ë˜ëŠ” tab3 ì˜ ì™„ì„±ëœ ë ˆì´ì•„ì›ƒì´ë‹¤.

![layout.png](https://raw.githubusercontent.com/hanalog/hanalog.github.io/gh-pages/images/2023-01-17-ciao2-13/layout.png)

## 6. ì‹œê°í™”

### 6.1. IN OUT

#### 1) tab1

- ë¡œê·¸ì¸ ë° ë¡œê·¸ì•„ì›ƒ ê´€ë ¨ ì‹œê°í™” tab1 ì€ ë‹¤ìŒê³¼ ê°™ì´ êµ¬í˜„í•˜ì˜€ë‹¤.

![tab1.png](https://raw.githubusercontent.com/hanalog/hanalog.github.io/gh-pages/images/2023-01-17-ciao2-13/tab1.png)

#### 2) tab1 ì˜ item1, item2, item3

- ê°€ì¥ ë§ì´ ë¡œê·¸ì¸í•œ ì‹œê°„ëŒ€ / ì—°ë ¹ëŒ€ / ì§€ì—­

```python
most_login_hour = (selected.groupby("hour")["login"].sum().sort_values().index[-1])
most_login_age = (selected.groupby("user_age")["login"].sum().sort_values().index[-1])
most_login_region = (selected.groupby("user_region")["login"].sum().sort_values().index[-1])

with item1:
        st.markdown("#### ê°€ì¥ ë§ì´ ë¡œê·¸ì¸í•œ ì‹œê°„")
        st.markdown(f"# <div style='text-align: center;'>{most_login_hour}ì‹œ </div>", unsafe_allow_html=True)
    with item2:
        st.markdown("#### ê°€ì¥ ë§ì´ ë¡œê·¸ì¸í•œ ì—°ë ¹")
        st.markdown(f"# <div style='text-align: center;'>{most_login_age}ëŒ€ </div>", unsafe_allow_html=True)
    with item3:
        st.markdown("#### ê°€ì¥ ë§ì´ ë¡œê·¸ì¸í•œ ì§€ì—­")
        st.markdown(f"# <div style='text-align: center;'>{most_login_region} </div>", unsafe_allow_html=True)
```

#### 3) tab1 ì˜ item4

![line1.png](https://raw.githubusercontent.com/hanalog/hanalog.github.io/gh-pages/images/2023-01-17-ciao2-13/line1.png)

```python
inout_by_hour = (
		selected.groupby(by=["hour"])[["login", "logout"]].sum().sort_index()
)
print(inout_by_hour.head(6))
---
				login  logout
hour               
13        6       6
14        4       4
15        7       5
16       10      10
17        2       4
18       10       4
```

```python
line1 = go.Figure()
line1.add_trace(go.Scatter(
    x=inout_by_hour.index,
    y=inout_by_hour["login"],
    name='<b>login</b>',
    line=dict(color='Salmon', width=5),
))
line1.add_trace(go.Scatter(
    x=inout_by_hour.index,
    y=inout_by_hour["logout"],
    name='<b>logout</b>',
    line=dict(color='CornflowerBlue', width=5),
))
line1.update_layout(margin=dict(t=0, l=10, r=10, b=0))
st.plotly_chart(line1)
```

#### 4) tab1 ì˜ item5

![bar1.png](https://raw.githubusercontent.com/hanalog/hanalog.github.io/gh-pages/images/2023-01-17-ciao2-13/bar1.png)

```python
login_by_age = (
		selected.groupby(by=["user_age"])["login"].sum().sort_index()
)
print(login_by_age)
---
user_age
10    15
20    13
30    19
40    24
99    12
```

```python
bar1 = px.bar(
            login_by_age,
            x=login_by_age.values,
            y=login_by_age.index,
            # color_discrete_sequence=['#0083B8'] * len(eco1_by_hour),
            color_discrete_sequence=["Salmon"],
            template='plotly_white',
            orientation='h',
            labels={'x': 'count'}
        )
bar1.update_layout(margin=dict(t=0, l=0, r=0, b=0))
st.plotly_chart(bar1)
```

#### 5) tab1 ì˜ item6

![pie1.png](https://raw.githubusercontent.com/hanalog/hanalog.github.io/gh-pages/images/2023-01-17-ciao2-13/pie1.png)

```python
login_by_gender = (
    selected.groupby(by=["user_gender"])["login"].sum()
)
print(login_by_gender)
---
user_gender
M       35
W       36
none    12
```

```python
pie1 = go.Figure(go.Pie(
    labels=login_by_gender.index,
    values=login_by_gender.values,
    hole=.3,
    marker_colors=px.colors.sequential.Sunset
))
pie1.update_layout(
    margin=dict(t=0, l=0, r=0, b=0),
    font = dict(family="Arial", size=25, color="#000000")
)
st.plotly_chart(pie1)
```

### 6.2. MENU

#### 1) tab2

- ë©”ë‰´(ì„œë¹„ìŠ¤) ì´ìš© ê´€ë ¨ ì‹œê°í™” tab2 ì€ ë‹¤ìŒê³¼ ê°™ì´ êµ¬í˜„í•˜ì˜€ë‹¤.

![Untitled](https://raw.githubusercontent.com/hanalog/hanalog.github.io/gh-pages/images/2023-01-17-ciao2-13/Untitled%201.png)

#### 2) tab2 ì˜ item1

![funnel1.png](https://raw.githubusercontent.com/hanalog/hanalog.github.io/gh-pages/images/2023-01-17-ciao2-13/funnel1.png)

```python
menu_by_age = (
    selected[["user_age", "menu_eco1", "menu_eco2", "menu_nolabel", "menu_lesswaste"]].groupby(
        by=["user_age"]).sum()
).stack().reset_index()
menu_by_age.columns = ["age", "menu", "click"]
menu_by_age["menu"] = menu_by_age["menu"].apply(lambda x: x.split('_')[1].upper())
print(menu_by_age.head(10))
---
age       menu  click
0    10       ECO1     16
1    10       ECO2      8
2    10    NOLABEL     19
3    10  LESSWASTE      6
4    20       ECO1     12
5    20       ECO2      6
6    20    NOLABEL     14
7    20  LESSWASTE      6
8    30       ECO1      8
9    30       ECO2      4
```

```python
funnel1 = px.funnel(
            menu_by_age,
            x='click',
            y='menu',
            color='age',
            color_discrete_sequence=px.colors.sequential.Sunset
        )
st.plotly_chart(funnel1)
```

#### 3) tab2 ì˜ item2

![sunburst1.png](https://raw.githubusercontent.com/hanalog/hanalog.github.io/gh-pages/images/2023-01-17-ciao2-13/sunburst1.png)

```python
menu_by_gender_age = (
    selected[["user_gender", "user_age", "menu_eco1", "menu_eco2", "menu_nolabel", "menu_lesswaste"]]\
		.groupby(by=["user_gender", "user_age"]).sum()
).stack().reset_index()
menu_by_gender_age.columns = ["gender", "age", "menu", "click"]
menu_by_gender_age["menu"] = menu_by_gender_age["menu"]\
														.apply(lambda x: x.split('_')[1].upper())
print(menu_by_gender_age.head())
---
gender  age       menu  click
0       M   10       ECO1      8
1       M   10       ECO2      4
2       M   10    NOLABEL      8
3       M   10  LESSWASTE      0
4       M   20       ECO1      4
...
16      W   10       ECO1      8
17      W   10       ECO2      4
18      W   10    NOLABEL     11
19      W   10  LESSWASTE      6
20      W   20       ECO1      8
...
31      W   40  LESSWASTE      0
32   none   99       ECO1      0
33   none   99       ECO2      4
34   none   99    NOLABEL      9
35   none   99  LESSWASTE     20
```

```python
sunburst1 = px.sunburst(
    menu_by_gender_age,
    path=["gender", "age", "menu"],
    values="click",
    color_discrete_sequence=px.colors.sequential.Sunset
)
sunburst1.update_layout(margin=dict(t=0, l=0, r=0, b=0))
st.plotly_chart(sunburst1)
```

#### 4) tab2 ì˜ item3

![gauge1.png](https://raw.githubusercontent.com/hanalog/hanalog.github.io/gh-pages/images/2023-01-17-ciao2-13/gauge1.png)

```python
eco1_demand = selected['ecopoint1_click'].sum() / selected['menu_eco1'].sum()
print(eco1_demand)
---
0.95
```

```python
gauge1 = go.Figure(go.Indicator(
    title={"text": "ECOPOINT ì ë¦½1"},
    value=round(eco1_demand * 100),
    number={"suffix": "%"},
    mode="gauge+number",
    gauge={
        "axis": {"range": [None, 100]},
        "bar": {"color": "Salmon"}
    }
))
st.plotly_chart(gauge1)
```

#### 5) tab2 ì˜ item4, item5, item6

- ë‚˜ë¨¸ì§€ item ë„ item3 ê³¼ ê°™ì€ ì½”ë“œì— eco1_demand ë³€ìˆ˜ ëŒ€ì‹  ë‹¤ìŒê³¼ ê°™ì€ ë³€ìˆ˜ë“¤ë¡œ ë³€ê²½í•´ì„œ ë„£ì–´ì£¼ë©´ ëœë‹¤.

```python
eco2_demand = selected['ecopoint2_click'].sum() / selected['menu_eco2'].sum()
nolabel_demand = selected['nolabel_click'].sum() / selected['menu_nolabel'].sum()
lesswaste_demand = selected['lesswaste_click'].sum() / selected['menu_lesswaste'].sum()
```

### 6.3. ECOPOINT

#### 1) tab3

- ECOPOINT ì ë¦½ ê´€ë ¨ ì‹œê°í™” tab3 ì€ ë‹¤ìŒê³¼ ê°™ì´ êµ¬í˜„í•˜ì˜€ë‹¤.

![tab3.png](https://raw.githubusercontent.com/hanalog/hanalog.github.io/gh-pages/images/2023-01-17-ciao2-13/tab3.png)

#### 2) tab3 ì˜ item1

![bar2.png](https://raw.githubusercontent.com/hanalog/hanalog.github.io/gh-pages/images/2023-01-17-ciao2-13/bar2.png)

```python
ecopoint_by_hour = selected[["hour", "save_ecopoint1", "save_ecopoint2"]]\
									.groupby(by=["hour"]).sum()
print(ecopoint_by_hour.head())
---
save_ecopoint1  save_ecopoint2
hour                                
13               300             130
14                40              60
15                 0              50
16               100              60
17               200              80
```

```python
bar2 = px.bar(
    ecopoint_by_hour,
    x=ecopoint_by_hour.index,
    y=["save_ecopoint1", "save_ecopoint2"],
    color_discrete_sequence=["#FFCC80", "Salmon"],
)
bar2.update_layout(margin=dict(t=0, l=0, r=0, b=0))
st.plotly_chart(bar2)
```

#### 3) tab3 ì˜ item2

![bubble1.png](https://raw.githubusercontent.com/hanalog/hanalog.github.io/gh-pages/images/2023-01-17-ciao2-13/bubble1.png)

```python
ecopoint_by_age = selected[["user_age", "save_ecopoint1", "save_ecopoint2"]]
ecopoint_by_age["user_age"] = ecopoint_by_age["user_age"].astype("int")
print(ecopoint_by_age.head(6))
---
user_age  save_ecopoint1  save_ecopoint2
0         10              20               0
1         99               0               0
2         20             100              50
3         30               0               0
4         10             100              30
5         20               0              30
```

```python
bubble1 = px.scatter(
    selected[["user_age", "save_ecopoint1", "save_ecopoint2"]],
    x="save_ecopoint1",
    y="save_ecopoint2",
    size="user_age",
    color="user_age",
    color_continuous_scale=px.colors.sequential.Sunset
)
bubble1.update_layout(yaxis_range=[10, 200], margin=dict(t=0, l=0, r=0, b=0))
st.plotly_chart(bubble1)
```

#### 4) tab3 ì˜ item3

![area1.png](https://raw.githubusercontent.com/hanalog/hanalog.github.io/gh-pages/images/2023-01-17-ciao2-13/area1.png)

```python
ecopoint_by_region = selected[selected["user_gender"]!="none"]
ecopoint_by_region["save_ecopoint"] = ecopoint_by_region["save_ecopoint1"] + ecopoint_by_region["save_ecopoint2"]
print(ecopoint_by_region.head())
---
date  hour user_gender  ...  save_ecopoint1 login  save_ecopoint
0   20221220    20           W  ...              20     0             20
2   20221220    17           W  ...             100     1            150
3   20221220    15           W  ...               0     1              0
4   20221220    13           M  ...             100     2            130
5   20221220    15           M  ...               0     2             30
```

```python
area1 = px.area(
    ecopoint_by_region,
    x="hour",
    y="save_ecopoint",
    color="user_region",
    color_discrete_sequence=px.colors.sequential.Sunset,
)
area1.update_layout(margin=dict(t=0, l=0, r=0, b=0))
st.plotly_chart(area1)
```

#### 5) tab3 ì˜ item4

![hist1.png](https://raw.githubusercontent.com/hanalog/hanalog.github.io/gh-pages/images/2023-01-17-ciao2-13/hist1.png)

```python
ecopoint_by_gender = ecopoint_by_region
```

```python
hist1 = px.histogram(
    ecopoint_by_gender,
    x="hour",
    y="save_ecopoint",
    color="user_gender",
    marginal="box",
    color_discrete_sequence=["#FFC6AF", "Salmon"],
    hover_data=selected.columns
)
hist1.update_layout(margin=dict(t=0, l=0, r=0, b=0))
st.plotly_chart(hist1)
```

### 6.4. NO LABEL

#### 1) tab4

- ë¬´ë¼ë²¨ ì œí’ˆ ê²€ìƒ‰ ê´€ë ¨ ì‹œê°í™” tab4 ì€ ë‹¤ìŒê³¼ ê°™ì´ êµ¬í˜„í•˜ì˜€ë‹¤.

![tab4.png](https://raw.githubusercontent.com/hanalog/hanalog.github.io/gh-pages/images/2023-01-17-ciao2-13/tab4.png)

#### 2) tab4 ì˜ item1

![pie2.png](https://raw.githubusercontent.com/hanalog/hanalog.github.io/gh-pages/images/2023-01-17-ciao2-13/pie2.png)

```python
condition = selected['user_gender'] == 'none'
nouser = sum(selected.loc[condition].nolabel_click)
user = sum(selected.loc[~condition].nolabel_click)
print(nouser)
print(user)
---
12
56
```

```python
pie2 = go.Figure(go.Pie(
    labels=["Users", "No Users"],
    values=[user, nouser],
    textinfo='label+percent',
    insidetextorientation='radial',
    hole=.3,
    marker_colors=["#FFCC80", "Salmon"],
    ))
pie2.update_layout(
    margin=dict(t=0, l=0, r=0, b=0),
    font=dict(family="Arial", size=15, color="#000000")
)
st.plotly_chart(pie2)
```

#### 3) tab4 ì˜ item2

![bar3.png](https://raw.githubusercontent.com/hanalog/hanalog.github.io/gh-pages/images/2023-01-17-ciao2-13/bar3.png)

```python
click_search = (
    selected[["hour", "nolabel_click", "nolabel_search"]].groupby(by=["hour"]).sum()
).stack().reset_index()
click_search.columns = ["hour", "type", "count"]
click_search["type"] = click_search["type"].apply(lambda x: x.split("_")[1])
print(click_search)
---
hour    type  count
0     13   click      9
1     13  search      6
2     14   click      6
3     14  search      4
4     15   click      6
5     15  search     12
```

```python
bar3 = px.bar(
    click_search,
    x="hour",
    y="count",
    color="type",
    color_discrete_sequence=["#FFC6AF", "Salmon"],
    barmode="group"
)
bar3.update_layout(margin=dict(t=0, l=0, r=0, b=0))
st.plotly_chart(bar3)
```

#### 4) tab4 ì˜ item3

![tree1.png](https://raw.githubusercontent.com/hanalog/hanalog.github.io/gh-pages/images/2023-01-17-ciao2-13/tree1.png)

```python
print(selected2)
---
date user_gender  user_age search_word  count
0  20221220           M        20         ì‚¬ì´ë‹¤      2
1  20221220           W        30         ì‚¬ì´ë‹¤      1
2  20221220           M        20          í™ì°¨      1
3  20221220           W        30          ìƒìˆ˜      1
4  20221220           M        20         í—›ê°œìˆ˜      1
5  20221220           W        30          ì½œë¼      1
6  20221220           M        20          ì½œë¼      1
```

```python
tree1 = px.treemap(
    selected2,
    path=['user_gender', 'user_age', 'search_word'],
    values='count',
    color_discrete_sequence=px.colors.sequential.Sunset,
)
tree1.update_traces(
    root_color="Salmon"
)
tree1.update_layout(
    margin=dict(t=0, l=15, r=15, b=0),
    font=dict(family="Arial", size=25, color="#000000")
)
st.plotly_chart(tree1)
```

## REFERENCES

- plotly ì°¨íŠ¸ ì°¸ê³ 
    - [https://plotly.streamlit.app/Distplot](https://plotly.streamlit.app/Distplot)
- plotly ìƒ‰ìƒ ì°¸ê³ 
    - [https://plotly.com/python/builtin-colorscales/](https://plotly.com/python/builtin-colorscales/)
- color list ì°¸ê³ 
    - [https://www.w3schools.com/colors/colors_names.asp](https://www.w3schools.com/colors/colors_names.asp)
- ì´ëª¨í‹°ì½˜ ì°¸ê³ 
    - [https://getemoji.com/](https://getemoji.com/)